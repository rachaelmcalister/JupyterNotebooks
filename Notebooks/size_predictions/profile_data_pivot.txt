WITH
quiz_sizes AS
(
    SELECT
        p.profile_id,
        p.finished_signup_at,
        s.dresses_base_size_id,
        s.tops_base_size_id,
        s.trousers_base_size_id,
        s.dresses_sizing_range_id,
        s.tops_sizing_range_id,
        s.trousers_sizing_range_id
    FROM activity_johnlewis.v_profile_this_partner AS p
    INNER JOIN shared_resources.d_profile_signup_size AS s
    ON p.profile_id = s.profile_id
    WHERE s.dresses_base_size_id IS NOT NULL
        AND '2019-01-01' <= finished_signup_at AND finished_signup_at < '2019-11-01'
),
quiz_sizes_pivot AS
(
    SELECT
        1 AS signup_size_category_id,
        profile_id,
        finished_signup_at,
        dresses_base_size_id AS base_size_id,
        dresses_sizing_range_id AS sizing_range_id
    FROM quiz_sizes
    UNION ALL
    SELECT
        6 AS signup_size_category_id,
        profile_id,
        finished_signup_at,
        tops_base_size_id AS base_size_id,
        tops_sizing_range_id AS sizing_range_id
    FROM quiz_sizes
    UNION ALL
    SELECT
        12 AS signup_size_category_id,
        profile_id,
        finished_signup_at,
        tops_base_size_id AS base_size_id,
        tops_sizing_range_id AS sizing_range_id
    FROM quiz_sizes
    UNION ALL
    SELECT
        9 AS signup_size_category_id,
        profile_id,
        finished_signup_at,
        trousers_base_size_id AS base_size_id,
        trousers_sizing_range_id AS sizing_range_id
    FROM quiz_sizes
)
SELECT 
    signup_size_category_id,
    profile_id,
    base_size_id,
    sizing_range_id
FROM quiz_sizes_pivot